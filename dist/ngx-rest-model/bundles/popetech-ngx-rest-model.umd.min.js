!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@popetech/ngx-rest-model",["exports","@angular/core","@angular/common/http","rxjs/operators"],e):e((t.popetech=t.popetech||{},t.popetech["ngx-rest-model"]={}),t.ng.core,t.ng.common.http,t.rxjs.operators)}(this,function(t,o,n,i){"use strict";var r=new o.InjectionToken("config"),a=function(){function t(t,e){this.http=t;var o=e.api_root;this.setBaseUrl(o),this.setApiRoot(o)}return t.prototype.setBaseUrl=function(t){this.baseUrl=t},t.prototype.getBaseUrl=function(){return this.baseUrl},t.prototype.setApiRoot=function(t){this.apiRoot=t},t.prototype.getApiRoot=function(){return this.apiRoot},t.prototype.getUrl=function(t,e){return void 0===e&&(e=!1),e?this.getApiRoot()+"/"+t:this.getBaseUrl()+"/"+t},t.prototype.get=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=!1);var r=this.getUrl(t,o);return e!={}?this.http.get(r,e).pipe(i.take(1)):this.http.get(r).pipe(i.take(1))},t.prototype.post=function(t,e,o,r){void 0===o&&(o=!1),void 0===r&&(r={});var n=this.getUrl(t,o);return r!={}?this.http.post(n,e,r).pipe(i.take(1)):this.http.post(n,e).pipe(i.take(1))},t.prototype.put=function(t,e,o){void 0===o&&(o=!1);var r=this.getUrl(t,o);return this.http.put(r,e).pipe(i.take(1))},t.prototype["delete"]=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=!1);var r=this.getUrl(t,o);return this.http["delete"](r).pipe(i.take(1))},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:n.HttpClient},{type:undefined,decorators:[{type:o.Inject,args:[r]}]}]},t}(),e=function(){return(e=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};var f=function(){function o(){}return o.add=function(t){var e=(new t).constructor.name.toLowerCase();o.models[e]||(o.models[e]=t)},o.get=function(t){return o.models[t]},o.models={},o}(),p=function(){function t(){this.modelConfig={key:"",uri:"",hidden:[],relationships:{}}}return t.prototype.setConfig=function(t){this.modelConfig=e({},this.getConfig(),t)},t.prototype.getConfig=function(){return this.modelConfig},t.prototype.getUri=function(){return this.modelConfig.uri},t.prototype.getSelfUri=function(){return this.modelConfig.uri+"/"+this[this.modelConfig.key]},t.prototype.setUri=function(t){this.modelConfig.uri=t},t.prototype.getKey=function(){return this.modelConfig.key},t.prototype.getRelationship=function(t){return this.modelConfig.relationships[t]},t.prototype.deserialize=function(t){var e,o,r=this.getConfig(),n=[];for(var i in t)t.hasOwnProperty(i)&&(-1<r.hidden.indexOf(i)||("object"!=typeof t[i]?this[this.snakeToCamel(i)]=t[i]:r.relationships.hasOwnProperty(this.snakeToCamel(i))&&n.push({key:this.snakeToCamel(i),value:t[i]?t[i].data:null})));try{for(var a=function c(t){var e="function"==typeof Symbol&&t[Symbol.iterator],o=0;return e?e.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}}(n),p=a.next();!p.done;p=a.next()){var s=p.value;if(null!==s.value){var u=r.relationships[s.key],l=f.get(u.model),d=new g(this,l,u.type);this[s.key]=y.makeRelatedFromRelationship(d,s.value)}}}catch(h){e={error:h}}finally{try{p&&!p.done&&(o=a["return"])&&o.call(a)}finally{if(e)throw e.error}}return this},t.prototype.snakeToCamel=function(t){return t.replace(/_\w/g,function(t){return t[1].toUpperCase()})},t}(),g=function(){function t(t,e,o){this.model=t,this.related=e,this.type=o}return t.prototype.setRelated=function(t){this.related=t},t.prototype.getRelated=function(){return this.related},t.prototype.setModel=function(t){this.model=t},t.prototype.create=function(){return this.related instanceof p||(this.related=new this.related),"hasMany"==this.type||"hasOne"==this.type?(this.related.setUri(this.model.getSelfUri()+"/"+this.related.getUri()),this.related):"belongsTo"==this.type?this.related:void 0},t.prototype.getModel=function(){},t.prototype.getUri=function(){},t}(),y=function(){function r(){}return r.make=function(t,e){return(new t).deserialize(e)},r.makeFromArray=function(t,e){for(var o=[],r=0;r<e.length;++r)o.push((new t).deserialize(e[r]));return o},r.makeRelated=function(t,e,o){var r=t.getRelationship(o),n=new g(t,e,r.type);return t[o]=n.create(),t.setUri(t[o].getSelfUri()+"/"+t.getUri()),t},r.makeRelatedFromRelationship=function(t,e){if("hasOne"==t.type||"belongsTo"==t.type)return t.create().deserialize(e);if("hasMany"==t.type){var o=t.getRelated();return r.makeFromArray(o,e)}},r}(),s=function(){function t(t){this.api=t}return t.prototype.setModel=function(t){this.model=t},t.prototype.find=function(t){var e=this,o=f.get(this.model.key);return this.api.get((new o).getUri()+"/"+t).pipe(i.map(function(t){return t.data=y.make(f.get(e.model.key),t.data),t}))},t.prototype.save=function(t){return t[t.getKey()]?this.update(t):this.createNew(t)},t.prototype.update=function(t){var e=t.serialize();return this.api.put(t.getUri()+"/"+t[t.getKey()],e)},t.prototype.createNew=function(t){var e=t.serialize();return this.api.post(t.getUri(),e)},t.prototype.destroy=function(t){return this.api["delete"](t.getUri()+"/"+t[t.getKey()])},t.prototype.get=function(t,e){var o=this;void 0===t&&(t=null),void 0===e&&(e={page:1});var r={params:new n.HttpParams};return 1!=e.page&&(r.params=(new n.HttpParams).set("page",String(e.page))),(null===t?this.api.get((new this.model).getUri(),r):this.api.get(t.getUri(),r)).pipe(i.map(function(t){var e=t.data;return t.data=y.makeFromArray(f.get(o.model.key),e),t}))},t.prototype.getRelated=function(t,e,o,r){void 0===o&&(o=null),void 0===r&&(r={}),null==o&&(o=this.model);var n=f.get(o.key);return o=y.makeRelated(new n,t,e),this.get(o)},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:a}]},t}(),u=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:r,useValue:t}]}},e.decorators=[{type:o.NgModule,args:[{imports:[],declarations:[],exports:[],providers:[a,s]}]}],e}();t.NgxRestModelModule=u,t.BaseModel=p,t.Relationship=g,t.ApiService=a,t.BackendService=s,t.Models=f,t.ModelFactory=y,t.Éµa=r,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=popetech-ngx-rest-model.umd.min.js.map